**```php```**

# 14.カスタム投稿タイプの作成

トップページのお知らせの箇所は「投稿」という箇所から作成しているため、HTMLでコードを書いて表示しているわけではありません。<br>
<img src="images/posts.jpg" alt="ワードプレスの画像" width="1000" height="350">

カリキュラム8の復習になりますが、コードでベタ書きをするのではなく、管理画面から内容を作成することで、サイトの更新やメンテナンスがとても楽になります！

また、管理画面からの投稿であればプログラミング未経験の人でも簡単に作成することができるので、お客さん自身でサイトの修正をすることが出来ます。<br>
（将来サイト制作をする際、お客さん自身がメンテナンス出来る状態にしてサイトを渡すことは頻繁にあります）

そこで、トップページの「ブログ」（画像）の箇所も管理画面から投稿できるように設定していきましょう！<br>
<img src="images/customblog.jpg" alt="ワードプレスの画像" width="900"><br>
現在ある「投稿」とは別に、新たな投稿を作ることを「カスタム投稿タイプを作る」と言ったりします。

<hr>

①カスタム投稿タイプは「Custom Post Type UI」というプラグインを使って作成していきます。<br>
まずは、プラグインをインストールしましょう。

<iframe width="900" height="600" src="https://www.youtube.com/embed/ZCQ1EKnxzcA?si=EmuMRdo4XTbH9Dax" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<hr>

②カスタム投稿タイプのスラッグや表示名を決め、実際に作成していきます。<br>
今回はブログに関するカスタム投稿タイプなので、スラッグは「blog」、表示名は日本語で「ブログ」とします。

<iframe width="900" height="600" src="https://www.youtube.com/embed/KYR_6mfqhVY?si=Fv27RihdT1EmLTYH" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<hr>

③次は、ブログの中身を作成していきます。<br>
これまでのようにHTMLでブログを作成するのではなく、カスタム投稿タイプを使ってブログを作成していきます。

<iframe width="900" height="600" src="https://www.youtube.com/embed/hBAKYkHPlPA?si=F2JtA478aSrExSCS" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<hr>

④作成したブログをトップページ「front-page.php」に表示させるコードを書いていきます。<br>
「front-page.php」に元々書いていたブログを表示するコード(< div class="list-grid" >)で囲まれている箇所を全て削除）し<br>
カスタム投稿タイプで作成したブログを表示するコードを書きます。<br>

先生は解説の都合上コードをコピーして貼り付けていますが、みんなは頑張ってコードを打ってください！

<iframe width="1000" height="700" src="https://www.youtube.com/embed/PP3iz-Mh1TM?si=0t2WjC94xe_1nDv1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<b>ブログ表示のコード(front-page.php)</b><br>

```html
<div class="list-grid">
<section class="top_blog">
	<?php
	$args = [
		'post_type' => 'blog',
		'posts_per_page'=> 3
	];
	$the_query = new WP_Query($args);
	?>

<?php if ($the_query->have_posts()): ?>
	<ul>
		<?php while ($the_query->have_posts()): $the_query->the_post(); ?>
		<li>
			<a href="<?php the_permalink() ?>">
				<div>
					<?php if (has_post_thumbnail()) : ?>
						<?php the_post_thumbnail(); ?>
					<?php endif; ?>
				</div>

				<div>
					<?php the_title(); ?>
					<a href="<?php the_permalink() ?>"><button>詳しく見る</button></a>
				</div>
			</a>
		</li>
		<?php endwhile; ?>
		<?php wp_reset_postdata();?>
		<?php endif; ?>
	</ul>
</section>
</div>
```

それでは、カスタム投稿タイプで作成したブログを表示するコードの解説をしていきます。

```php
$args =[]
```
　argsという名前の配列を作成

```php
'post_type' => 'blog',
```
投稿タイプのスラッグを指定（今回はblogというスラッグで作成したのでblogというスラッグを指定しています）

```php
'posts_per_page'=> 3
```
表示件数を指定する（今回のブログは3件表示なので3になっています）

```php
$the_query = new WP_Query($args);
```
「WP_Query」というワードプレスであらかじめ用意されているクラスを使ってインスタンスを生成し、それを「$the_query」という名の変数に代入している（オブジェクトの作成）<br>
「WP_Query」には値を入れたいので、入れたい値を引数「args」で取得してきている

簡単に説明すると、<b>「ブログを3件表示させるための設定を上の4つのコードで行っている」ということになります。</b><br>
（お決まりのようなものなので、完全に理解しなくても大丈夫です）

```php
<?php if ($the_query->have_posts()): ?>
```
 もし、先ほど作成した「$the_query」というオブジェクトの中に投稿データがあれば

 ```php
<?php while ($the_query->have_posts()): $the_query->the_post(); ?>
```
投稿がある間中ずっと、投稿のデータを取得してセットする<br>
（セットするだけでは表示はされません。そのセットされたものを目に見える形で表示するためのコードが下のコードになります）

 ```php
<a href="<?php the_permalink() ?>">
```
投稿のURLを取得して表示する

 ```php
<?php if (has_post_thumbnail()) : ?>
```
もしサムネイル画像があれば〜

 ```php
<?php the_post_thumbnail(); ?>
```
サムネイル画像を表示する

 ```php
<?php endif; ?>
```
if文を閉じる

 ```php
<?php the_title(); ?>
```
ブログのタイトルを表示する

 ```php
<a href="<?php the_permalink() ?>"><button>詳しく見る</button></a>
```
投稿のURLを取得して表示する

 ```php
<?php endwhile; ?>
```
while文を閉じる


 ```php
<?php wp_reset_postdata();?>
```
セットした情報をリセットする（これがないと情報がリセットされず他のコードに影響が出るので、必ず書く必要があります）

<hr>

## 上記コードを記述して、動画のようにブログが表示されていれば成功です！<br>このコードは何度も出てくるものになるので、たくさん使うことで理解を深めていきましょう！

<hr>
最後に、ブログのレイアウトを整えるためにcssを記述をします。<br>
cssは今回学習したい内容ではないので、cssのコードはコピーしてそのまま貼り付けてください。

記述する箇所は93・94・95行目のいずれかに記述してください。

```css
/* style.cssに記述するコード */
.top_blog{
	width: 1300px;
}

.top_blog li{
	list-style: none;
}

.top_blog ul{
	display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
}
```

<hr>

## ユーザースニペットの登録
ブログ表示のコードのように、長いコードを打ち込むのは大変だと思います。<br>
そこで、使いたいコードを簡単に入力することができる「ユーザースニペット」という機能があるので、今後はこれを使用していきましょう！

まずは解説動画を見て、ユーザースニペットの登録方法を学習しましょう！
<iframe width="900" height="600" src="https://www.youtube.com/embed/1Fv8jR9JhPY?si=OwpdDnXlQWViIlOt" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

よく出てくるコードをまとめたので、このコードもユーザースニペットに登録しておきましょう！

<b>スタプロのパソコンを使っている場合、すでに他の生徒が登録している可能性があるため、一度prefixを入力してコードが出てくるか試してみましょう！<br>もし他の人が登録していれば、新たに登録する必要はないので使い方だけ覚えておきましょう！</b>

```php
{
	"the_titleを呼び出す":{
		"prefix": "title",
		"body": "<?php the_title(); ?>"
	}

	"the_contentを呼び出す":{
		"prefix": "content",
		"body": "<?php the_content(); ?>"
	}

	"get_headerを呼び出す":{
		"prefix": "gh",
		"body": "<?php get_header(); ?>"
	}

	"get_footerを呼び出す":{
		"prefix": "gf",
		"body": "<?php get_footer(); ?>"
	}

	"wp_headを呼び出す":{
		"prefix": "wh",
		"body": "<?php wp_head();?>"
	}

	"wp_footerを呼び出す":{
		"prefix": "wf",
		"body": "<?php wp_footer();?>"
	}
	
	"wp_body_openを呼び出す":{
		"prefix": "wo",
		"body": "<?php wp_body_open();?>"
	}

	"home_urlを呼び出す":{
		"prefix": "home",
		"body": "<?php echo home_url(''); ?>"
	}

	"get_theme_file_uriを呼び出す":{
		"prefix": "get",
		"body": "<?php echo esc_url(get_theme_file_uri(''));?>"
	}

	"if have posts〜の命令を呼び出す": {
		"prefix": "have",
		"body": [
		  "<?php if (have_posts()): ?>",
		  "  <?php while (have_posts()):the_post(); ?>",
		  "      <a href=\"<?php the_permalink(); ?>\">",
		  "        <div class=\"date\"><?php echo get_the_date('Y.m.d'); ?></div>",
		  "        <div class=\"ttl\"><?php the_title(); ?></div>",
		  "      </a>",
		  "  <?php endwhile; ?>",
		  "<?php endif; ?>"
		],
	  }
}
```

<hr>

## 練習問題
なし
